<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Platform Abstraction Layer 2  - OpenTK</title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Platform Abstraction Layer 2 ">
    <meta name="generator" content="docfx ">
  
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
  
  
  

    <meta name="author" content="The Open Toolkit Project">
    <meta property="og:image" content="https://opentk.net/otkBig.png">
    <meta property="og:image:width" content="142">
    <meta property="og:image:height" content="50">
    <meta property="og:site_name" content="OpenTK">
    <meta property="og:title" content="Platform Abstraction Layer 2  - OpenTK">
    <meta name="theme-color" content="#ffffff">
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation" style="background: #0052cc;">
          <div class="container">
            <a class="navbar-brand" href="../../index.html">
          <img id="logo" src="../../otkBig.png" alt="">
        </a>
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="platform-abstraction-layer-2">Platform Abstraction Layer 2</h1>

<div class="IMPORTANT">
<h5>Important</h5>
<p>PAL2 is under development and many things might change in the future.
Feedback is wanted!</p>
</div>
<div class="IMPORTANT">
<h5>Important</h5>
<p>Currently PAL2 is basically feature complete on Windows, and most parts work on x11 and macos. There is an slightly outdated SDL backend that works on both Windows and linux, and should in theory work on macos but the SDL binaries nuget package doesn't have macos binaries yet.</p>
</div>
<h2 id="setup">Setup</h2>
<p>PAL2 exposes platform APIs through a number of interfaces used to abstract away the underlying operating system.</p>
<p>Most of PAL2 is exposed through the <code>Toolkit</code> class. <code>Toolkit</code> contains a number of static properties that are the main interface for PAL2. <code>ToolkitOptions</code> contains a few configuration items should be set before calling <code>Toolkit.Init</code>.</p>
<pre><code class="lang-cs">using OpenTK.Platform;

ToolkitOptions options = new ToolkitOptions();

// ApplicationName is the name of the application
// this is used on some platforms to show the application name.
options.ApplicationName = &quot;OpenTK tutorial&quot;;

Toolkit.Init(options);
</code></pre>
<h2 id="logging">Logging</h2>
<p>PAL2 has the ability to output diagnostic messages through an <code>ILogger</code> interface exposed as a <code>Logger</code> property of <code>ToolkitOptions</code>. This can be useful to find errors in the code and provide debug data that can be used to fix bugs in OpenTK.</p>
<p>OpenTK provides an implementation of this interface called <code>ConsoleLogger</code> that writes out all debug messages to the console.</p>
<pre><code class="lang-cs">ToolkitOptions options = new ToolkitOptions();

// ApplicationName is the name of the application
// this is used on some platforms to show the application name.
options.ApplicationName = &quot;OpenTK tutorial&quot;;
// Set the logger to use
options.Logger = new ConsoleLogger();

Toolkit.Init(options);
</code></pre>
<h2 id="creating-a-window">Creating a window</h2>
<p>To create an OpenGL window using PAL2 we want to use the <code>Toolkit.Window</code> property to access the window functions in PAL2. <code>Toolkit.Window</code> contains a function called <code>Toolkit.Window.Create</code> which we will use to create a window, and <code>Toolkit.OpenGL.CreateFromWindow</code> can be used to create an OpenGL context from the created window.</p>
<pre><code class="lang-cs">OpenGLGraphicsApiHints contextSettings = new OpenGLGraphicsApiHints()
{
    // Here different options of the opengl context can be set.
    Version = new Version(4, 1),
    Profile = OpenGLProfile.Core,
    DebugFlag = true,
    DepthBits = ContextDepthBits.Depth24,
    StencilBits = ContextStencilBits.Stencil8,
};

WindowHandle window = Toolkit.Window.Create(contextSettings);

OpenGLContextHandle glContext = Toolkit.OpenGL.CreateFromWindow(window);
</code></pre>
<p>This returns a handle to the window and the opengl context which is used to refer to the window and opengl context in pal2 functions.</p>
<p>When a window handle is created it is not visible by default, so we need to show the window. We also need to set the size we want the window to be shown with. This can be done by setting the window size and mode like so:</p>
<pre><code class="lang-cs">// Set the title of the window
Toolkit.Window.SetTitle(window, &quot;OpenTK window&quot;);
// Set the size of the window
Toolkit.Window.SetSize(window, 800, 600);
// Bring the window out of the default Hidden window mode
Toolkit.Window.SetMode(window, WindowMode.Normal);
</code></pre>
<p>Before we can do any calls to OpenGL we need to do two things.</p>
<ol>
<li>We need to set our created context as the &quot;current&quot; context and</li>
<li>Load all of the functions that OpenGL is going to use.</li>
</ol>
<p>This can quite easily be done like follows:</p>
<pre><code class="lang-cs">// The the current opengl context and load the bindings.
Toolkit.OpenGL.SetCurrentContext(glContext);
GLLoader.LoadBindings(Toolkit.OpenGL.GetBindingsContext(glContext));
</code></pre>
<p><a class="xref" href="../../api/OpenTK.Platform.IOpenGLComponent.html#OpenTK_Platform_IOpenGLComponent_SetCurrentContext_OpenTK_Platform_OpenGLContextHandle_"><code>Toolkit.OpenGL.SetCurrentContext</code></a> sets the given OpenGL context as the &quot;current&quot; context.</p>
<!--FIXME: Say something about what "current" context even means.-->
<p>And <a class="xref" href="../../api/OpenTK.Graphics.GLLoader.html#OpenTK_Graphics_GLLoader_LoadBindings_OpenTK_IBindingsContext_"><code>GLLoader.LoadBindings</code></a> loads all OpenGL functions.</p>
<!--FIXME: Say something about lazy loading?-->
<p>Now we want to set up our event loop so we can interact with our newly created window. Without any event processing most of the window functions will not happen and no window interaction will be possible.</p>
<p>A simple event loop might look like the following:</p>
<pre><code class="lang-cs">while (true)
{
    // This will process events for all windows and
    //  post those events to the event queue.
    Toolkit.Window.ProcessEvents(false);
    // Check if the window was destroyed after processing events.
    if (Toolkit.Window.IsWindowDestroyed(window))
    {
        break;
    }

    // Render something here
}
</code></pre>
<p>To render something to the window we can do the following:</p>
<pre><code class="lang-cs">GL.ClearColor(new Color4&lt;Rgba&gt;(64 / 255f, 0, 127 / 255f, 255));
GL.Clear(ClearBufferMask.ColorBufferBit | ClearBufferMask.DepthBufferBit | ClearBufferMask.StencilBufferBit);

Tooklit.OpenGL.SwapBuffers(glContext);
</code></pre>
<p>The code shown so far will create a window and then process events while rendering to the window, but running the code there is one crucial flaw to the program. Closing the window doesn't work.</p>
<p>This is becase closing the window is an event that needs to be responeded to, and as we are not handling any events no action is taken when the user wants to quit the application. So lets fix that!</p>
<p>First step of handling events is to register a callback to the <code>EventQueue.EventRaised</code> event. Do this before creating the window like follows:</p>
<pre><code class="lang-cs">EventQueue.EventRaised += EventRaised;
</code></pre>
<p>Now we need to define the <code>EventRaised</code> function.</p>
<pre><code class="lang-cs">void EventRaised(PalHandle? handle, PlatformEventType type, EventArgs args)
{

}
</code></pre>
<div class="WARNING">
<h5>Warning</h5>
<p>The arguments of the event callback are likely to change.</p>
</div>
<p>This callback gets a few arguments, the one we are interested in right now is <code>args</code>.
<code>args</code> contains data specific to the type of event and we can pattern match on a specific args type to respond to a specific event.</p>
<p>To handle the quit message we will do the following:</p>
<pre><code class="lang-cs">void EventRaised(PalHandle? handle, PlatformEventType type, EventArgs args)
{
    if (args is CloseEventArgs closeArgs)
    {
        // Destroy the window that the user wanted to close.
        Toolkit.Window.Destroy(closeArgs.Window);
    }
}
</code></pre>
<p>We use pattern matching <code>is</code> on <code>args</code> to check if it is of type <code>CloseEventArgs</code>. <code>CloseEventArgs</code> contains a <code>window</code> property which tells us which window the user wanted to close.
So to close the window we call <code>Toolkit.Window.Destroy(WindowHandle)</code> to destroy the window.</p>
<p>This way of handling events generalizes to other event types. First check for the type of event, then cast the <code>EventArgs</code> to the type specific for this type of event which gives appropriate information for handling the event.</p>
<p>The final code we end up with could look like the following:</p>
<pre><code class="lang-cs">using OpenTK.Platform;
using OpenTK.Graphics;
using OpenTK.Graphics.OpenGL;
using OpenTK.Mathematics;
using OpenTK.Core.Utility;
using System;

namespace Pal2Sample;

class Sample
{
    public static void Main(string[] args)
    {
        EventQueue.EventRaised += EventRaised;

        ToolkitOptions options = new ToolkitOptions();

        options.ApplicationName = &quot;OpenTK tutorial&quot;;
        options.Logger = new ConsoleLogger();

        Toolkit.Init(options);

        OpenGLGraphicsApiHints contextSettings = new OpenGLGraphicsApiHints()
        {
            // Here different options of the opengl context can be set.
            Version = new Version(4, 1),
            Profile = OpenGLProfile.Core,
            DebugFlag = true,
            DepthBits = ContextDepthBits.Depth24,
            StencilBits = ContextStencilBits.Stencil8,
        };

        WindowHandle window = Toolkit.Window.Create(contextSettings);

        OpenGLContextHandle glContext = Toolkit.OpenGL.CreateFromWindow(window);

        // Show window
        Toolkit.Window.SetTitle(window, &quot;OpenTK window&quot;);
        Toolkit.Window.SetSize(window, 800, 600);
        Toolkit.Window.SetMode(window, WindowMode.Normal);

        // The the current opengl context and load the bindings.
        Toolkit.OpenGL.SetCurrentContext(glContext);
        GLLoader.LoadBindings(Toolkit.OpenGL.GetBindingsContext(glContext));

        while (true)
        {
            // This will process events for all windows and
            // post those events to the event queue.
            Toolkit.Window.ProcessEvents(false);
            if (Toolkit.Window.IsWindowDestroyed(window))
            {
                break;
            }

            GL.ClearColor(new Color4&lt;Rgba&gt;(64 / 255f, 0, 127 / 255f, 255));
            GL.Clear(ClearBufferMask.ColorBufferBit | ClearBufferMask.DepthBufferBit | ClearBufferMask.StencilBufferBit);

            Toolkit.OpenGL.SwapBuffers(glContext);
        }
    }

    static void EventRaised(PalHandle? handle, PlatformEventType type, EventArgs args)
    {
        if (args is CloseEventArgs closeArgs)
        {
            // Destroy the window that the user wanted to close.
            Toolkit.Window.Destroy(closeArgs.Window);
        }
    }
}

</code></pre>
<h2 id="whats-next">What's next?</h2>
<p>Now that you have a basic program working you can look more into the different components of PAL2 here: <a href="Components.html">Components</a> or alternatively read more about the different evens that PAL2 supports: <a href="Event-Handling.html">Event Handling</a>.</p>

</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In this article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      
      <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
